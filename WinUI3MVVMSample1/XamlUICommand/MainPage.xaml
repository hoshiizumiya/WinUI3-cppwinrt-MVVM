<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XamlUICommand.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XamlUICommand"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <local:ColorConverter x:Key="ColorConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <Canvas Grid.Row="0" x:Name="CanvasMovableRect" Background="Transparent">
            <Rectangle x:Name="MovableRect"
                        Width="100" Height="50"
                        Fill="{x:Bind RectangleColor, Mode=OneWay, Converter={StaticResource ColorConverter}}">
                <!-- 右键菜单 -->
                <Rectangle.ContextFlyout>
                    <MenuFlyout>
                        <MenuFlyoutItem x:Name="MenuFillRed" />
                        <MenuFlyoutItem x:Name="MenuFillGreen" />
                        <MenuFlyoutItem x:Name="MenuFillBlue" />
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem x:Name="MenuToggleVisibility" />
                    </MenuFlyout>
                </Rectangle.ContextFlyout>
            </Rectangle>
        </Canvas>

        <!-- 底部控制区 (两行结构) -->
        <Grid Grid.Row="1" RowDefinitions="Auto,Auto" Margin="0,0,0,20">
            <!-- 第一行：颜色选择器按钮 -->
            <Button Content="🎨"
                Grid.Row="0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Margin="0,0,0,10"
                Click="OnShowColorPicker"/>

            <!-- 第二行：其他控制按钮 -->
            <StackPanel Orientation="Horizontal"
                    Grid.Row="1"
                    HorizontalAlignment="Center"
                    Spacing="5">
                <Button x:Name="BtnLeft" />
                <Button x:Name="BtnRight" />

                <!-- 设置菜单 -->
                <Button Content="Settings">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem x:Name="MenuBottomFillRed" />
                            <MenuFlyoutItem x:Name="MenuBottomFillGreen" />
                            <MenuFlyoutItem x:Name="MenuBottomFillBlue" />
                            <MenuFlyoutSeparator />
                            <MenuFlyoutItem x:Name="MenuBottomToggleVisibility" />
                        </MenuFlyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>
        </Grid>
        <!-- 颜色选择器面板 -->
        <StackPanel x:Name="ColorPickerPanel"
                Background="{StaticResource SystemColorBackgroundBrush }"
                Padding="10"
                Visibility="Collapsed"
                HorizontalAlignment="Left"
                VerticalAlignment="Stretch"
                Width="345"
                Opacity="0"
            >
            <StackPanel.RenderTransform>
                <TranslateTransform x:Name="ColorPickerTransform" X="-250"/>
            </StackPanel.RenderTransform>
            
            <TextBlock Text="Pick a color" FontWeight="Bold" />
            <!-- 颜色选择器 -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                    HorizontalScrollBarVisibility="Disabled" 
                    Height="500">
                <ColorPicker x:Name="ColorPickerControl"
                            IsAlphaEnabled="True"
                            IsMoreButtonVisible="False"
                            IsColorPreviewVisible="False"
                            IsColorSpectrumVisible="True"
                            IsColorSliderVisible="True"
                            Width="300"
                            MinHeight="400"
                            Color="{x:Bind RectangleColor, Mode=TwoWay, Converter={StaticResource ColorConverter}}"/>
            </ScrollViewer>
            <ItemsPresenter x:Name="ColorPickerPresenter"  Height="24"/>
            <Button Content="Close" Click="OnHideColorPicker"/>
                
        </StackPanel>
    </Grid>
</Page>
